<!DOCTYPE html>
<html>
<head>
    <title>관리자 페이지</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="admin-page">

    <nav class="navbar navbar-dark bg-dark border-bottom border-secondary mb-4 shadow">
        <div class="container">
            <span class="navbar-brand fw-bold">
                <i class="bi bi-shield-lock-fill text-danger me-2"></i>ADMIN SYSTEM
            </span>
            <a href="/dashboard" class="btn btn-sm btn-outline-light">사이트로 돌아가기</a>
        </div>
    </nav>

    <div class="container">
        
        <div class="card admin-card shadow">
            <div class="card-body">
                <h4 class="mb-3 text-white border-start border-4 border-danger ps-2">
                    <i class="bi bi-people-fill"></i> 전체 회원 관리
                </h4>
                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                    <table class="table table-sm table-dark table-hover text-center align-middle">
                        <thead>
                            <tr>
                                <th>ID</th><th>이름</th><th>이메일</th><th>지역</th><th>관리</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in all_users %}
                            <tr>
                                <td>{{ user.user_id }}</td>
                                <td class="fw-bold">{{ user.name }}</td>
                                <td>{{ user.email }}</td>
                                <td><span class="badge bg-secondary">{{ user.location }}</span></td>
                                <td>
                                    {% if user.email != 'admin@test.com' %}
                                    <a href="/admin/delete_user/{{ user.user_id }}" class="btn btn-sm btn-danger py-0" onclick="return confirm('이 회원을 영구 삭제하시겠습니까? (복구 불가)')">추방</a>
                                    {% else %}
                                    <span class="badge bg-warning text-dark">Admin</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card admin-card shadow">
            <div class="card-body">
                <h4 class="mb-3 text-white border-start border-4 border-primary ps-2">
                    <i class="bi bi-collection-fill"></i> 전체 그룹 관리
                </h4>
                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                    <table class="table table-sm table-dark table-hover text-center align-middle">
                        <thead>
                            <tr>
                                <th>ID</th><th>그룹명</th><th>주제</th><th>방장ID</th><th>관리</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for group in all_groups %}
                            <tr>
                                <td>{{ group.group_id }}</td>
                                <td class="text-start ps-3 fw-bold">{{ group.gName }}</td>
                                <td><span class="badge bg-info text-dark">{{ group.subject }}</span></td>
                                <td>{{ group.group_leader_id }}</td>
                                <td>
                                    <a href="/admin/delete_group/{{ group.group_id }}" class="btn btn-sm btn-danger py-0" onclick="return confirm('이 그룹을 폭파하시겠습니까?')">삭제</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card admin-card shadow">
            <div class="card-body">
                <h4 class="mb-3 text-white border-start border-4 border-warning ps-2">
                    <i class="bi bi-activity"></i> 실시간 학습 로그 (최신 50개)
                </h4>
                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                    <table class="table table-sm table-dark table-hover align-middle" style="font-size: 0.9rem;">
                        <thead>
                            <tr>
                                <th width="20%">시간</th>
                                <th width="15%">사용자</th>
                                <th width="15%">과목</th>
                                <th width="40%">내용</th>
                                <th width="10%">시간</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in all_logs %}
                            <tr>
                                <td class="text-secondary small">{{ log.start_time }}</td>
                                <td class="fw-bold">{{ log.user_name }}</td>
                                <td><span class="badge bg-light text-dark">{{ log.subject }}</span></td>
                                <td>{{ log.content }}</td>
                                <td class="text-warning fw-bold">{{ log.minutes }}m</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>